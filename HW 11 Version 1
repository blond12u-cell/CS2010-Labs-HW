-- Can Solve all Original Mazes

local GLASS_SLOT = 2 -- Ensure your glass block is in this slot

local function victory()
    print("We finished the maze!")
    turtle.up()
    -- Spin around to celebrate
    for _ = 1, 4 do
        turtle.turnRight()
    end   
end

local function look()
    -- Check the block underneath for start (green) or end (yellow) markers
    local ok, data = turtle.inspectDown()
    
    if ok and data.name and data.name:find("yellow") then
        victory()
        return true
    end   
    
    return false
end

local function inspect_up()
    local ok, data = turtle.inspectUp()
    -- We look for "glass" in the block's name property
    return ok and data.name and data.name:find("glass")
end

local function place_glass()
    local current_slot = turtle.getSelectedSlot()
    turtle.select(GLASS_SLOT)
    local success = turtle.placeUp()
    turtle.select(current_slot) -- Return to the previous slot
    return success
end

local function detect_right()
    turtle.turnRight()
    local is_blocked = turtle.detect()
    turtle.turnLeft() -- Turn back to original orientation
    return is_blocked
end

local function detect_left()
    turtle.turnLeft()
    local is_blocked = turtle.detect()
    turtle.turnRight() -- Turn back to original orientation
    return is_blocked
end

turtle.select(1) -- Select fuel slot (slot 1)
turtle.refuel(10)
if turtle.getFuelLevel() < 10 then
    print("Insert fuel in slot 1")
    return
end

while true do
    -- 1. Check for win condition
    local done = look()
    if done then 
        return
    end
    
    local moved = false
    
    if inspect_up() then
        print("Marker found above (Glass). Turning right to avoid backtracking and moving forward.")
        turtle.turnRight()
        if turtle.forward() then 
            moved = true
        end
    end

    local is_front_clear = not turtle.detect()
    local is_right_clear = not detect_right()
    local is_left_clear = not detect_left()

    if is_front_clear and is_right_clear and is_left_clear then
        print("3-Way Intersection detected. Placing glass marker and moving straight.")
        place_glass()
        if turtle.forward() then 
            moved = true
        end

    elseif is_right_clear then
        print("RHR: Right side clear. Turning right and moving.")
        turtle.turnRight()
        if turtle.forward() then 
            moved = true
        end
    
    elseif is_front_clear then
        print("RHR: Front clear. Moving straight.")
        if turtle.forward() then 
            moved = true
        end

    elseif is_left_clear then
        print("RHR: Left side clear. Turning left and moving.")
        turtle.turnLeft()
        if turtle.forward() then 
            moved = true
        end
    
    else
        print("Dead end. Turning around (180 degrees).")
        turtle.turnLeft() -- Turn 90
        turtle.turnLeft() -- Turn another 90 (180 total)
    end

    if not moved and turtle.getFuelLevel() == 0 then
        print("Out of fuel. Halting.")
        return
    end
    
    if not moved and (is_front_clear or is_right_clear or is_left_clear) then
        print("Movement failed unexpectedly despite clear path. Halting.")
        return
    end
end
